image: nberlette/gitpod-enhanced

tasks:
  - init: |
      # set the deno environment variables prior to install
      _RC=$'\n### THE SECTION BELOW IS AUTOGENERATED ### ./o\n'
      _RC+=$'export DENO_INSTALL="$HOME/.deno"\n'
      _RC+=$'export DENO_INSTALL_ROOT="$DENO_INSTALL/bin"\n'
      _RC+=$'export PATH="$DENO_INSTALL_ROOT:$PATH"\n\n'
      _RC+=$'which deno &>/dev/null || curl -fsSL https://deno.land/install.sh | sh -\n'
      _RC+=$'### END AUTOMATICALLY GENERATED SECTION ###'

      grep -q "${_RC}" "$HOME/.bashrc" || echo "${_RC}" >> "$HOME/.bashrc";
      source "$HOME/.bashrc"
    before: |
      # ensure all of our code (up to 3 levels deep) have cached dependencies
      if which deno &>/dev/null; then
        files=$(find . -type f \( -name "*.ts" -or -name "*.mjs" -or -name "*.js" \) -maxdepth 1)
        for f in $files; do deno cache --reload --lock-write $f 2>&1; done
      if
    command: |
      # fallback to displaying all available tasks if 'dev' is unavailable
      deno task dev 2>/dev/null || deno task

vscode:
  extensions:
    - denoland.vscode-deno
    - editorconfig.editorconfig
    - vsls-contrib.gistfs
    - redhat.vscode-yaml
    - gitpod.gitpod-desktop
    - gitpod.gitpod-remote-ssh

github:
  prebuilds:
    master: true
    branches: true
    pullRequests: true
    addLabel: "gitpod"
    addCheck: "prevent-merge-on-error"
    addBadge: true

ports:
  - port: 8000-8888
    visibility: private
    onOpen: open-preview
